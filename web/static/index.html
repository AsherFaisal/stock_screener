<!DOCTYPE html>

<head>
    <link href="static/css/tabulator_site.min.css" rel="stylesheet">
    <script type="text/javascript" src="static/js/tabulator.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#23191C">
    <title>Nordic stock screener</title>
</head>

<body>
    <div>
        <h1>Nordic stock screener</h1>
        <button onclick="reload_table()">Reload table</button>
        <div style="margin-left: 10%; margin-right: 10%; width: 80%" id="example-table"></div>
        <a id="download_data_link" href="#"><button>Download csv</button></a>
        <form action="/logout" method="POST"><input type="submit" value="Logout"></form>
    </div>

    <script type="text/javascript">
        function ajax_get(url, callback) {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    console.log('responseText:' + xmlhttp.responseText);
                    try {
                        var data = JSON.parse(xmlhttp.responseText);
                    } catch (err) {
                        console.log(err.message + " in " + xmlhttp.responseText);
                        return;
                    }
                    callback(data);
                }
            };

            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }

        //define table
        function update_table(data) {

            var table = new Tabulator("#example-table", {
                pagination: "local", //enable local pagination.
                paginationSize: 20,
                data: data,
                autoColumns: true,
                layout: "fitDataFill"
            });

            var dl_link = document.getElementById("download_data_link");

            dl_link.onclick = function () {
                table.download("csv", "data.csv");
                return false;
            }
        };

        function reload_table() {
            ajax_get('/stocks', function (data) {
                update_table(data)
            });
        };

        window.onload = reload_table


    </script>
</body>