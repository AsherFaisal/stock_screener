<!DOCTYPE html>

<head>
    <link href="static/css/tabulator_simple.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <link href="static/css/index.css" rel="stylesheet">
    <script type="text/javascript" src="static/js/tabulator.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#23191C">
    <link rel="shortcut icon" href="static/img/favicon.png">
    <title>Nordic stock screener</title>
</head>

<body>
    <div class="main">
        <div class="buttonribbon">
            <h1>Nordic stock screener</h1>
            <button id="reload" class="actionbtn" onclick="reload_table()">Reload table</button>
            <a id="download_data_link" href="#"><button class="actionbtn">Download csv</button></a>
            <form id="logout" action="/logout" method="POST"><button class="actionbtn"><input style="display: none"
                        type="submit" value="Logout">Logout</button></form>
        </div>
        <div class="tablecontainer">
            <div class="tablewrapper">
                <div id="example-table"></div>
            </div>
        </div>


    </div>

    <script type="text/javascript">
        function ajax_get(url, callback) {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    console.log('responseText:' + xmlhttp.responseText);
                    try {
                        var data = JSON.parse(xmlhttp.responseText);
                    } catch (err) {
                        console.log(err.message + " in " + xmlhttp.responseText);
                        return;
                    }
                    callback(data);
                }
            };

            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }

        //define table
        function update_table(data) {

            var table = new Tabulator("#example-table", {
                pagination: "local", //enable local pagination.
                paginationSize: 20,
                data: data,
                autoColumns: true,
                layout: "fitDataFill"
            });

            var dl_link = document.getElementById("download_data_link");

            dl_link.onclick = function () {
                table.download("csv", "data.csv");
                return false;
            }
        };

        function reload_table() {
            ajax_get('/stocks', function (data) {
                update_table(data)
            });
        };

        window.onload = reload_table


    </script>
</body>
